#!/bin/bash

set -eux

# Available variables
# $BOSH_COMPILE_TARGET - where this package & spec'd source files are available
# $BOSH_INSTALL_TARGET - where you copy/install files to be included in package
export HOME=/var/vcap

baseDir=$BOSH_INSTALL_TARGET
cacheDir="$baseDir/apt/cache"
mkdir -p "$cacheDir"

options="-o debug::nolocking=true -o dir::cache=$cacheDir"

apt-get install -y apt-transport-https apt-utils

curl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > microsoft.gpg
sudo mv microsoft.gpg /etc/apt/trusted.gpg.d/microsoft.gpg
echo "deb [arch=amd64] https://packages.microsoft.com/repos/microsoft-ubuntu-trusty-prod trusty main" > /etc/apt/sources.list.d/dotnetdev.list
apt-key adv --keyserver apt-mo.trafficmanager.net --recv-keys 417A0893

apt-get update
apt-get install ${options} -y -d dotnet-runtime-2.0.0