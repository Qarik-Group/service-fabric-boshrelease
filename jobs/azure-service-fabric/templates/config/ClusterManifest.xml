<?xml version="1.0" encoding="utf-8"?>
<ClusterManifest xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" Name="Test Generated ClusterManifest" Version="v1" Description="Test Generated ClusterManifest" xmlns="http://schemas.microsoft.com/2011/01/fabric">
  <NodeTypes>
    <NodeType Name="N<%= spec.name %>Ref">
      <Endpoints>
        <!-- see ServiceFabricServiceModel.xsd under FabricEndpointsType -->
        <ClientConnectionEndpoint Port="19000" />
        <LeaseDriverEndpoint Port="19001" />
        <ClusterConnectionEndpoint Port="19002" />
        <ServiceConnectionEndpoint Port="19006" />
        <HttpGatewayEndpoint Port="19080" Protocol="http" />
        <HttpApplicationGatewayEndpoint Port="19081" Protocol="http" />
        <ApplicationEndpoints StartPort="22001" EndPort="23000" />

        <ApplicationEndpoints
          StartPort="<%= p('ApplicationEndpoints.Start') %>"
          EndPort="<%= p('ApplicationEndpoints.End') %>" />
      </Endpoints>
      <!--Certificates>
        <ClusterCertificate X509FindType = "FindBySubjectName" X509FindValue="*.eastus.cloudapp.azure.com" />
        <ServerCertificate X509FindType = "FindBySubjectName" X509FindValue="*.eastus.cloudapp.azure.com" />
        <ClientCertificate X509FindType = "FindBySubjectName" X509FindValue="*.eastus.cloudapp.azure.com" />
      </Certificates-->
    </NodeType>
  </NodeTypes>
  <Infrastructure>
    <Linux IsScaleMin="true">
      <NodeList> <!-- TODO list of instances in link -->
        <Node NodeName="N<%= spec.name %>"
          NodeTypeRef="N<%= spec.name %>Ref"
          IPAddressOrFQDN="<%= spec.address %>"
          IsSeedNode="<%= spec.bootstrap %>"
          FaultDomain="fd:/<%= spec.az %>"
          UpgradeDomain="<%= spec.az %>" />
      </NodeList>
    </Linux>
  </Infrastructure>
  <FabricSettings>
    <Section Name="Trace/Console">
        <Parameter Name="Level" Value="2" />
        <Parameter Name="Filters" Value="HttpGateway:5,Managed:5,TokenValidationServiceAgent:5" />
    </Section>
    <Section Name="Trace/Etw">
        <Parameter Name="Level" Value="4" />
    </Section>
    <Section Name="Trace/File">
        <Parameter Name="Level" Value="4" />
        <Parameter Name="Option" Value="p,m" />
        <Parameter Name="Path" Value="/var/vcap/sys/log/azure-service-fabric/aad.trace" />
    </Section>
    <Section Name="Federation">
      <Parameter Name="NodeIdGeneratorVersion" Value="V4" />
    </Section>
    <Section Name="ClusterManager">
      <!-- The default target and min replica set sizes are 7 and 5. The below configuration is not required for cluster that have 7 or more nodes.  -->
      <Parameter Name="TargetReplicaSetSize" Value="3" />
      <Parameter Name="MinReplicaSetSize" Value="3" />
      <Parameter Name="UpgradeStatusPollInterval" Value="5" />
      <Parameter Name="UpgradeHealthCheckInterval" Value="5" />
      <Parameter Name="FabricUpgradeHealthCheckInterval" Value="5" />
    </Section>
    <Section Name="FailoverManager">
      <!-- expected cluster size allows the placement to start when the cluster is started. This value should be less than total number of nodes
            as without it the FailoverManager will not start the placement of the user services. This value should be 80% to 90% of the cluster size.
      -->
      <Parameter Name="ExpectedClusterSize" Value="4" />
      <!-- The default target and min replica set sizes are 7 and 5. The below configuration is not required for cluster that have 7 or more nodes.  -->
      <Parameter Name="TargetReplicaSetSize" Value="3" />
      <Parameter Name="MinReplicaSetSize" Value="3" />
      <Parameter Name="ReconfigurationTimeLimit" Value="20" />
      <Parameter Name="BuildReplicaTimeLimit" Value="20" />
      <Parameter Name="CreateInstanceTimeLimit" Value="20" />
      <Parameter Name="PlacementTimeLimit" Value="20" />
    </Section>
    <Section Name="Hosting">
      <Parameter Name="EndpointProviderEnabled" Value="true" />
      <Parameter Name="RunAsPolicyEnabled" Value="true" />
      <Parameter Name="DeactivationScanInterval" Value="60" />
      <Parameter Name="DeactivationGraceInterval" Value="10" />
      <Parameter Name="EnableProcessDebugging" Value="true" />
      <Parameter Name="ServiceTypeRegistrationTimeout" Value="20" />
      <Parameter Name="CacheCleanupScanInterval" Value="300" />
    </Section>
    <Section Name="HttpGateway">
      <Parameter Name="IsEnabled" Value="True" />
      <Parameter Name="VersionCheck" Value="True" />
    </Section>
    <Section Name="Management">
        <Parameter Name="ImageStoreConnectionString" Value="file:/var/vcap/store/azure-service-fabric/ImageStore" />
    </Section>
    <Section Name="NamingService">
      <!-- The default target and min replica set sizes are 7 and 5. The below configuration is not required for cluster that have 7 or more nodes.  -->
      <Parameter Name="TargetReplicaSetSize" Value="3" />
      <Parameter Name="MinReplicaSetSize" Value="3" />
    </Section>
    <Section Name="ImageStoreService">
      <Parameter Name="TargetReplicaSetSize" Value="3" />
      <Parameter Name="MinReplicaSetSize" Value="1" />
    </Section>
    <Section Name="PerformanceCounterLocalStore">
      <Parameter Name="IsEnabled" Value="False" />
    </Section>
    <Section Name="PlacementAndLoadBalancing">
      <!-- balance the load on the cluster every 5 minutes.  -->
      <Parameter Name="MinLoadBalancingInterval" Value="300" />
    </Section>
    <Section Name="ReconfigurationAgent">
      <Parameter Name="ServiceApiHealthDuration" Value="20" />
      <Parameter Name="ServiceReconfigurationApiHealthDuration" Value="20" />
      <Parameter Name="LocalHealthReportingTimerInterval" Value="5" />
      <Parameter Name="IsDeactivationInfoEnabled" Value="true" />
      <Parameter Name="RAUpgradeProgressCheckInterval" Value="3" />
    </Section>
    <Section Name="FabricClient">
      <Parameter Name="HealthReportSendInterval" Value="1" />
    </Section>
    <Section Name="Diagnostics">
      <Parameter Name="ProducerInstances" Value="WinFabLttProducer" />
      <Parameter Name="ConsumerInstances" Value="AzureWinFabCsv"/>
    </Section>
    <Section Name="WinFabLttProducer">
      <Parameter Name="ProducerType" Value="LttProducer"/>
      <Parameter Name="IsEnabled" Value="true"/>
    </Section>
    <Section Name="AzureWinFabCsv">
      <Parameter Name="ConsumerType" Value="AzureBlobCsvUploader"/>
      <Parameter Name="ProducerInstance" Value="WinFabLttProducer"/>
      <Parameter Name="IsEnabled" Value="true"/>
      <Parameter Name="StoreConnectionString" Value="xstore:DefaultEndpointsProtocol=https;AccountName=[];AccountKey=[]"/>
      <Parameter Name="ContainerName" Value="fabriclogs"/>
    </Section>
    <Section Name="RunAs_DCA">
      <Parameter Name="RunAsAccountType" Value="LocalSystem" />
    </Section>

    <!-- The sections below specify parameters for the logs used by the different stateful system services.
          LogSize specifies the size of the log used for by the system service. It is in units of bytes.
          MaximumRecordSize  specifies the size of the maximum record that can be stored in the log. It is in units of bytes.
          Important Note: The log size must be at least 16 times the size of the maximum record. So in the settings below, the log size is 128MB and the maximum record size is 8MB. 16 times 8MB is 128MB. If the log size is less than 16 times the maximum record size, the cluster will not start.-->
    <Section Name="ClusterManager/SharedLog">
      <Parameter Name="LogSize" Value="134217728"/>
      <Parameter Name="MaximumRecordSize" Value="8388608" />
    </Section>
    <Section Name="FileStoreService/SharedLog">
      <Parameter Name="LogSize" Value="134217728"/>
      <Parameter Name="MaximumRecordSize" Value="8388608" />
    </Section>
    <Section Name="Naming/SharedLog">
      <Parameter Name="LogSize" Value="134217728"/>
      <Parameter Name="MaximumRecordSize" Value="8388608" />
    </Section>
    <Section Name="Failover/SharedLog">
      <Parameter Name="LogSize" Value="134217728"/>
      <Parameter Name="MaximumRecordSize" Value="8388608" />
    </Section>

    <Section Name="Security">
      <Parameter Name="ClusterCredentialType" Value="None" />
      <Parameter Name="ServerAuthCredentialType" Value="None" />
    </Section>
    <!-- <Section Name="Security">
        <Parameter Name="ClusterCredentialType" Value="None"/>
        <Parameter Name="ServerAuthCredentialType" Value="X509"/>
        <Parameter Name="CrlCheckingFlag" Value="0"/>
        <Parameter Name="ServerCertThumbprints" Value="BD1C71E248B8C6834C151174DECDBDC02DE1D954"/>
        <Parameter Name="AdminClientCertThumbprints" Value="BD1C71E248B8C6834C151174DECDBDC02DE1D954"/>
        <Parameter Name="ClientCertThumbprints" Value="BD1C71E248B8C6834C151174DECDBDC02DE1D954"/>
        <Parameter Name="X509Folder" Value="/var/vcap/store/azure-service-fabric/Certs" />
        <Parameter Name="AADTenantID" Value="9b2560bf-210a-4bd7-b039-15daa6265945" />
        <Parameter Name="AADClusterApplication" Value="5ce658d7-0dd8-4341-8050-4d95cc4d6770" />
        <Parameter Name="AADClientApplication" Value="4b62276d-6c71-4be1-a5c0-ebe147e78db4" />
    </Section> -->

  </FabricSettings>
</ClusterManifest>
